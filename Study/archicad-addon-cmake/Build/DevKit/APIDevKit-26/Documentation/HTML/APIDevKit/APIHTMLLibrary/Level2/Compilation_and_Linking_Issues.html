<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
    <title>Compilation and Linking Issues</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <meta http-equiv="Content-Language" content="en-US">
    <meta name="Author" content="GRAPHISOFT SE">
    <link rel="stylesheet" type="text/css" href="../../StyleLibrary/Style.css">
    <script type="text/javascript" src="../../StyleLibrary/Java.js"></script>
    <script type="text/javascript" src="../../StyleLibrary/TOCscript.js"></script>
    <script type="text/javascript">
      LEVELSTR = "../../";
      ICONPATH = LEVELSTR + "StyleLibrary/Images/Treeview/";
    </script>
    <script type="text/javascript" src="../../StyleLibrary/TOC.js"></script>
    <script type="text/javascript" src="../../StyleLibrary/tree_tpl.js"></script>
    <script type="text/javascript" src="../../StyleLibrary/tree.js"></script>
    <meta name="Microsoft.Help.F1" content="APIHTMLLibrary/Level2/Compilation_and_Linking_Issues.html">
    <xml>
      <MSHelp:Attr Name = "DocSet" Value = "Graphisoft"/>
    </xml>
</head>
<body>
<div id="docBegin">
  <p id="graphisoft_title">&nbsp;<span>Graphisoft&reg;</span></p>
  <p class="hdr"><span class="TitleMain">API&nbsp;Development&nbsp;Kit</span><span class="TitleVersion">Version: 26</span></p>
</div>
<div id="content" class="inset">
          <script type="text/javascript">
            insertTOC ();
          </script>


    <h1>Compilation and Linking Issues</h1>

    <p>&nbsp;<br>
    The recommended way of development is that you should use the given example projects rather than creating your own project. Although these projects are fully configured to API development, we would like to call your attention to some especially important issues.</p>

    <p>However if you would like to create a new project you can use the <a href="../Level3/Tools_XcodeTemplate.html">Xcode Template</a> on macOS. All of the following configurations are already set in the projects generated by this.</p>

    <h4>Compiler directives: <code>macintosh</code> or <code>WINDOWS</code>, <code>ACExtension</code></h4>

    <blockquote>
        <p>Most of the include files require the above directives to be defined.</p>

        <table border="1">
            <tr>
                <th>Platform</th>

                <th>Settings</th>
            </tr>

            <tr>
                <td>macOS</td>

                <td>
                    set the <i>Preprocessor Macros</i> in Project Info (section: GCC 4.0 - Preprocessing) to<br>

                    <blockquote>
                        <pre><code>
macintosh=1 ACExtension
</code></pre>
                    </blockquote>
                </td>
            </tr>

            <tr>
                <td>Windows</td>

                <td><code>ACExtension</code> and <code>WINDOWS</code> are usually defined in the source/header files before including the <code>ACAPinc.h</code> header.</td>
            </tr>
        </table>
    </blockquote>

    <h4>Enums Always Int: ON</h4>

    <blockquote>
        The structures in APIdefs_xxx.h refer to enum variables, and therefore its size must be strictly defined. (In Xcode this is the default value.)
    </blockquote>

    <h4>Struct Alignment: 8 byte</h4>

    <blockquote>
        This is required because of compatibility reasons.<br>
        <br>
        &nbsp; <img border="0" src="../../APIImageLibrary/61.png" alt="6.1" width="19" height="12">&nbsp; Please note that from Archicad 9 in the API structures the built-in <code>bool</code> type has been replaced with <strong><code>GS::Bool8</code></strong>. The reason for that is the migration to the new GCC compiler on the MacTel platform, where <code>bool</code> is implemented as a type with a size of 4 bytes rather than 1 byte. In order to maintain the structures aligned, a new type has been introduced in the <em>GSRoot</em> module, which is compiled to 1 byte on both platforms (<code>GS::Bool8</code> stands for 8-bit boolean type).
    </blockquote>

    <h4>Calling convention: __cdecl</h4>

    <blockquote>
        The communication between Archicad and add-ons suppose <code>__cdecl</code> type parameter passing. In Visual C++ you should set this compiler flag in the Calling Convention line of the C/C++/Advanced page in Solution Properties. On Macintosh, the only standard calling convention style is used.
    </blockquote>

    <h4>File name extension, creator and type</h4>

    <blockquote>
        On Windows you must change the standard .dll file extension to .apx (can be adjusted in the Linker/General/Output File tab in Solution Properties).
    </blockquote>

    <blockquote>
        In Xcode add the following key-value pairs to the <tt>Info.plist</tt> file:<br>
        <pre>
   &lt;key&gt;CFBundlePackageType&lt;/key&gt;
        &lt;string&gt;.APX&lt;/string&gt;
        &lt;key&gt;CFBundleSignature&lt;/key&gt;
        &lt;string&gt;GSAP&lt;/string&gt;
    </pre>
    </blockquote>

    <h4>Export lists</h4>

    <blockquote>
        In order to establish a connection between Archicad and add-ons, you must make export function from your DLL / code fragment. These functions are platform dependent, and are coded in the shipped libraries. The only thing you should do is just export them.

        <p>On both platforms the functions named <code>GetExportedFuncAddrs</code> and <code>SetImportedFuncAddrs</code> must be exported. On Windows set the following Additional Options in the Linker/Command Line page in Solution Properties:<br></p>
        <pre>
/export:GetExportedFuncAddrs,@1 /export:SetImportedFuncAddrs,@2
</pre>or use a <i>project_name</i>.def file:

        <p><i>Example.def</i></p>
        <pre><code>
GetExportedFuncAddrs
SetImportedFuncAddrs
</code></pre>
    </blockquote>

    

</div>
<div id="footer">
    <p class="hdr1">      <span class="Credits">Copyright &copy; 2022 - GRAPHISOFT SE. All rights reserved worldwide. <br />Modified on Feb 3, 2017<br/>
      </span>
    </p>
    <p id="toplink"><a href="#docBegin"><img src="../../StyleLibrary/Images/top.gif" alt="top" width="31" height="14" id="toTopImg" /></a></p>
</div>
</body>
</html>
