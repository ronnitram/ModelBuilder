<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
    <title>Compatibility</title>
    <meta name="author" content="Akos Somorjai">
    <meta name="description" content="This document discusses comaptibility issues.">
    <meta name="keywords" content="Archicad, API, 10, compatibility">

    <meta http-equiv="Content-Language" content="en-US">
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <link rel="stylesheet" type="text/css" href="../../StyleLibrary/Style.css">
    <script type="text/javascript" src="../../StyleLibrary/Java.js"></script>
    <script type="text/javascript" src="../../StyleLibrary/TOCscript.js"></script>
    <script type="text/javascript">
      LEVELSTR = "../../";
      ICONPATH = LEVELSTR + "StyleLibrary/Images/Treeview/";
    </script>
    <script type="text/javascript" src="../../StyleLibrary/TOC.js"></script>
    <script type="text/javascript" src="../../StyleLibrary/tree_tpl.js"></script>
    <script type="text/javascript" src="../../StyleLibrary/tree.js"></script>
    <meta name="Microsoft.Help.F1" content="APIHTMLLibrary/Level1/Compatibility.html">
    <xml>
      <MSHelp:Attr Name = "DocSet" Value = "Graphisoft"/>
    </xml>
</head>
<body>
<div id="docBegin">
  <p id="graphisoft_title">&nbsp;<span>Graphisoft&reg;</span></p>
  <p class="hdr"><span class="TitleMain">API&nbsp;Development&nbsp;Kit</span><span class="TitleVersion">Version: 26</span></p>
</div>
<div id="content" class="inset">
          <script type="text/javascript">
            insertTOC ();
          </script>


    <h1>API Compatibility</h1>

    <p><strong>Summary:</strong> This document discusses issues related to add-on compatibility.</p>

    <ol type="1" start="0">
        <li><a href="#Intro">Introduction</a></li>

        <li>
            <a href="#Areas">API compatibility</a>

            <ol type="a">
                <li><a href="#Interface">Interface</a></li>

                <li><a href="#Library">Library</a></li>
            </ol>
        </li>
    </ol>
    <hr class="separator_line">

    <h2><a name="Intro" id="Intro">0. Introduction</a></h2>

    <p>For a good summary on (C++) compatibility, see <!--NoIdx--><a href="Invalid link: https://community.kde.org/Policies/Binary_Compatibility_Issues_With_C%2B%2B">this page</a> from the KDE site. We'll use the terms <b>binary</b> and <b>source compatible</b> the way they were defined on that page. The first type is superior (and of course, more valuable) from the developer's point of view, as this doesn't require any work from your side.</p>

    <p>Between the previous Archicad versions, and 21 we do not ensure binary compatibility because of the interface changes of several modules, so add-ons compiled with older DevKits cannot be loaded in Archicad 21. The add-ons developed for Archicad 20 or earlier must be re-compiled with this new DevKit in order to enable them to run with Archicad 21.</p>

    <p>This document explains what compatibility means from the add-on developer's point, and what you can do about it.</p>
    <hr class="separator_line">

    <h2><a name="Areas" id="Areas">1. API compatibility</a></h2>

    <p>Below we'll take a look at the different areas of the API where this may be an issue.</p>

    <h3><a name="Interface" id="Interface">1.a Interface</a></h3>

    <p>By definition, an interface to a library can fulfill only source level compatibility. This means that the functionality of the API can only be extended with new functions, and the old functions shouldn't change.</p>

    <p>The API (by itself) provides only a C interface (we have to admit this in not really true any more from Archicad 8). This C interface is easier to keep source and binary compatible, because the different compilers generate the same code for the same interface. Also, the ACAP_STAT.lib contains a function table, where we left many places for the introduction of new functions.</p>

    <p>If an old function is not relevant any more, then it should still sit there and mimic the behavior it provided in previous versions. This may require serious internal programming effort, as we would have to implement the old functionality internally over a newer set of internal interfaces. If the old functionality is still viable, just requires extra parameters to provide the functionality available in the actual version of Archicad, then we can introduce a new function (much like the ...Ex functions in the Windows platform SDK). In the C interface, in the past we used the filler places in the function table to store the addresses of these functions.</p>

    <p>In the C++ world, the (virtual) function table is generated by the compiler, and no filler 'place' exists. So, if we introduce a new function in this interface, then all code linked to this C++ library would suddenly become unusable, and your add-on would not be loaded by Archicad.</p>

    <p><i><b>Recommendation:</b></i> stick to the C interface if you want to stay binary compatible. This also applies to other modules, for example the file/folder dialogs in the DG module. There are certain places where you can't achieve this (most notably the InputOutput module); but then expect to compile your add-on as a new (maintenance) version Archicad reaches your market.</p>

    <p><img border="0" src="../../APIImageLibrary/10.png" alt="Featuring API 10" width="19" height="12">&nbsp; Note that the CIO interface of the InputOutput module is not supported any more, use the C++ IO interface instead.</p>

    <h3><a name="Library" id="Library">1.b Library</a></h3>

    <p>The API Development Kit contains two versions of the API library, ACAP_STAT.lib. In most cases you link your code to the static library, which provides the main entry points to the add-on (DLL/bundle), and builds up an internal function table where it stores all the addresses of the available functions. This static library also provides a version number for the API interface of Archicad, which can be used internally to provide the expected behavior of the application for an add-on if a subsequent maintenance release appears.</p>

    <p>A very important point in the version controlling process is the obligatory <code>CheckEnvironment</code> function:</p>

    <blockquote>
        <pre><code>
// -----------------------------------------------------------------------------
// Dependency definitions
// -----------------------------------------------------------------------------
API_AddonType    __ACENV_CALL    CheckEnvironment (API_EnvirParams* envir)
{
    // for tool-type add-ons: skip if not in Archicad
    if (envir-&gt;serverInfo.serverApplication != APIAppl_ArchiCADID)
        return APIAddon_DontRegister;

    RSGetIndString (&amp;envir-&gt;addOnInfo.name, 32000, 1, ACAPI_GetOwnResModule ());
    RSGetIndString (&amp;envir-&gt;addOnInfo.description, 32000, 2, ACAPI_GetOwnResModule ());

    return APIAddon_Normal;
}        // CheckEnvironment
</code></pre>
    </blockquote>

    <p>The <code>API_EnvirParams</code> structure contains the main and the maintenance version of the server application. Based on this information your add-on can decide whether it wants to run in the current server application. For example, a bug has been corrected in the R2/v2 version of Archicad 8.1, which prevented the operation of your add-on in 8.1 R1/v1. In this case you can test the server application's version in the <code>CheckEnvironment&nbsp;()</code> function, and return <code>APIAddon_DontRegister</code> if <code>envir-&gt;serverInfo.releaseVersion &lt; 2</code>.</p>

    

</div>
<div id="footer">
    <p class="hdr1">      <span class="Credits">Copyright &copy; 2022 - GRAPHISOFT SE. All rights reserved worldwide. <br />Modified on October 5, 2018<br/>
      </span>
    </p>
    <p id="toplink"><a href="#docBegin"><img src="../../StyleLibrary/Images/top.gif" alt="top" width="31" height="14" id="toTopImg" /></a></p>
</div>
</body>
</html>
